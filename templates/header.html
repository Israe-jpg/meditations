<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>header</title>
</head>
<body>
    <!-- Navigation-->
    {% if show_header is defined and show_header == false %}
    <style>
        @media (min-width: 992px) {
            #mainNav {
                background-color: #000 !important;
                background: #000 !important;
            }
        }
    </style>
    {% endif %}
    <nav class="navbar navbar-expand-lg {% if show_header is not defined or show_header %}navbar-light{% else %}navbar-dark{% endif %}" id="mainNav">
        <div class="container">
            <a class="navbar-brand medieval-brand" href="{{ url_for('home') }}">Meditations</a>
            
            <!-- Always visible items on the right (search, hamburger, then profile) -->
            <div class="d-flex align-items-center order-lg-2">
                <!-- Search functionality -->
                <!-- Preview of the search bar -->
                <div class="position-relative me-3" id="searchInputPrev">
                    <button class="btn btn-outline-success" type="submit" 
                                style="border-radius: 20px; border: 1px solid #198754;" onclick="toggleSearchInput()">  
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0,0,256,256" style="fill:#40C057;">
                                <g fill="#40c057" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">
                                    <g transform="scale(3.55556,3.55556)">
                                        <path d="M31,11c-11.027,0 -20,8.973 -20,20c0,11.027 8.973,20 20,20c3.97417,0 7.67238,-1.17843 10.78906,-3.18555l12.9375,12.9375c1.664,1.664 4.36239,1.664 6.02539,0c1.664,-1.664 1.664,-4.36139 0,-6.02539l-12.9375,-12.9375c2.00712,-3.11668 3.18555,-6.8149 3.18555,-10.78906c0,-11.027 -8.973,-20 -20,-20zM31,19c6.616,0 12,5.384 12,12c0,6.616 -5.384,12 -12,12c-6.616,0 -12,-5.384 -12,-12c0,-6.616 5.384,-12 12,-12z"></path>
                                    </g>
                                </g>
                            </svg>
                        </button>
                </div>
                <!-- After clicking on it result -->
                <div class="position-relative me-3" id="searchInputDiv" style="display: none;">
                     <form class="d-flex" onsubmit="return performSearch()">
                         <input id="searchInput" class="form-control" type="search" placeholder="Search posts..."  
                               style="border-radius: 20px 0 0 20px; border-right: none; min-width: 180px;"
                               oninput="getSuggestions()" onblur="setTimeout(() => hideSuggestions(), 500)">
                                             <button class="btn btn-outline-success" type="submit" onclick="toggleSearchInput()"
                                 style="border-radius: 20px; border: 1px solid #198754;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0,0,256,256" style="fill:#40C057;">
                                <g fill="#40c057" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">
                                    <g transform="scale(3.55556,3.55556)">
                                        <path d="M31,11c-11.027,0 -20,8.973 -20,20c0,11.027 8.973,20 20,20c3.97417,0 7.67238,-1.17843 10.78906,-3.18555l12.9375,12.9375c1.664,1.664 4.36239,1.664 6.02539,0c1.664,-1.664 1.664,-4.36139 0,-6.02539l-12.9375,-12.9375c2.00712,-3.11668 3.18555,-6.8149 3.18555,-10.78906c0,-11.027 -8.973,-20 -20,-20zM31,19c6.616,0 12,5.384 12,12c0,6.616 -5.384,12 -12,12c-6.616,0 -12,-5.384 -12,-12c0,-6.616 5.384,-12 12,-12z"></path>
                                    </g>
                                </g>
                            </svg>
                        </button>
                    </form>
                    
                    <!-- Simple suggestions dropdown -->
                    <div id="suggestions" class="position-absolute w-100 bg-white border rounded shadow-sm" 
                         style="top: 100%; left: 0; z-index: 1000; display: none; max-height: 200px; overflow-y: auto;">
                    </div>
                </div>
                
                <!-- Hamburger menu button (always visible) -->
                <button class="navbar-toggler me-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-bars" style="color: #40C057; font-size: 1.5rem;"></i>
                </button>
                
                <!-- Profile picture (always visible - last on the right) -->
                {% if current_user.is_authenticated %}
                <div class="dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="border: none; padding: 0;">
                        <img src="{{ url_for('static', filename=current_user.profile_picture or 'default_profile.jpg') }}" alt="Profile" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown" style="min-width: 120px; background-color: #1e1d1d; border: none; border-radius: 10px; padding: 0;">
                        <li><a class="dropdown-item" style="color: #40C057;" href="{{ url_for('profile') }}">
                            <i class="fas fa-user me-2" style="color: #40C057;"></i>Profile
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li ><a class="dropdown-item" style="color: #40C057;" href="{{ url_for('logout') }}">
                            <i class="fas fa-sign-out-alt me-2" style="color: #40C057;"></i>Logout
                        </a></li>
                    </ul>
                </div>
                {% endif %}
            </div>
            
            <!-- Collapsible content -->
            <div class="collapse navbar-collapse order-lg-1" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="{{ url_for('home') }}">Home</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="{{ url_for('about') }}">About</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="{{ url_for('contact') }}">Contact</a></li>
                    {% if not current_user.is_authenticated %}
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="{{ url_for('login') }}">Log in</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    
    
    <!-- Page Header-->
    {% if show_header is not defined or show_header %}
    {% set background_type = page_background_type or 'image' %}
    {% if background_type == 'black' %}
        <header class="masthead" style="background: linear-gradient(135deg, #1a1a1a 0%, #000000 50%, #000000 100%); min-height: 50vh;">
    {% elif background_type == 'image' or background_type == 'custom' %}
        <header class="masthead" style="background-image: url('{{ page_background_image }}'); min-height: 50vh;">
    {% else %}
        <!-- Fallback to black background -->
        <header class="masthead" style="background: linear-gradient(135deg, #1a1a1a 0%, #000000 50%, #000000 100%); min-height: 50vh;">
    {% endif %}
        <div class="container position-relative px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5">
                <div class="col-md-10 col-lg-8 col-xl-7 float-left">
                    {% if page_meta %}
                    <!-- Post heading (smaller) -->
                    <div class="post-heading">
                        <h1>{{ page_title or 'Post Title' }}</h1>
                        <h2 class="subheading">{{ page_subtitle or 'Post Subtitle' }}</h2>
                        <span class="meta">{{ page_meta }}</span>
                    </div>
                    {% else %}
                    <!-- Regular page heading (larger) -->
                    <div class="site-heading">
                        <h1>{{ page_title or 'Page Title' }}</h1>
                        <span class="subheading">{{ page_subtitle or 'Page Subtitle' }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>
    {% endif %}

    <!-- Search suggestions script for the search bar -->
    <script>
    let searchTimeout;

    function performSearch() {
        const query = document.getElementById('searchInput').value.trim();
        if (query) {
            window.location.href = `/search?q=${encodeURIComponent(query)}`;
        }
        return false;
    }

    function getSuggestions() {
        const query = document.getElementById('searchInput').value.trim();
        
        clearTimeout(searchTimeout);
        
        if (query.length < 2) {
            hideSuggestions();
            return;
        }
        
        searchTimeout = setTimeout(() => {
            fetch(`/search_suggestions?query=${encodeURIComponent(query)}`)
                .then(r => r.json())
                .then(showSuggestions)
                .catch(() => hideSuggestions());
        }, 300);
    }

    function showSuggestions(results) {
        const div = document.getElementById('suggestions');
    
        
        if (!results.length) {
            hideSuggestions();
            return;
        }
        
        div.innerHTML = results.map(r => {
            
            return `<a href="${r.url}" class="d-block p-2 text-decoration-none text-dark border-bottom" 
                       onclick="console.log('Link clicked:', '${r.url}')" 
                       onmousedown="event.stopPropagation()">
                <strong>${r.title}</strong>
                ${r.subtitle ? `<br><small class="text-muted">${r.subtitle}</small>` : ''}
            </a>`;
        }).join('');
        
        div.style.display = 'block';
    }

    function hideSuggestions() {
        document.getElementById('suggestions').style.display = 'none';
    }

         function toggleSearchInput() {
         const searchInputDiv = document.getElementById('searchInputDiv');
         const searchInputPrev = document.getElementById('searchInputPrev');
         const searchButton = searchInputDiv.querySelector('button');
         
         if (searchInputDiv.style.display == 'block') {
             // Hide full search, show preview
             searchInputDiv.style.display = 'none';
             searchInputPrev.style.display = 'block';
         } else {
             // Show full search, hide preview
             searchInputDiv.style.display = 'block';
             searchInputPrev.style.display = 'none';
             // Change button styling to connect with input
             searchButton.style.borderRadius = '0 20px 20px 0';
             searchButton.style.borderLeft = 'none';
         }
     }
    </script>
    
</body>
</html>